<!DOCTYPE html>
<html>
<head>
    <title>Debug Authentification</title>
</head>
<body>
    <h1>Debug Authentification</h1>
    <div id="results"></div>
    
    <script>
        function log(message) {
            const div = document.getElementById('results');
            div.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        // Vérifier les tokens dans localStorage
        const accessToken = localStorage.getItem('accessToken');
        const refreshToken = localStorage.getItem('refreshToken');
        const user = localStorage.getItem('user');
        
        log('=== TOKENS DANS LOCALSTORAGE ===');
        log('Access Token: ' + (accessToken ? 'Présent (' + accessToken.length + ' caractères)' : 'Absent'));
        log('Refresh Token: ' + (refreshToken ? 'Présent (' + refreshToken.length + ' caractères)' : 'Absent'));
        log('User: ' + (user ? 'Présent' : 'Absent'));
        
        if (user) {
            try {
                const userData = JSON.parse(user);
                log('User data: ' + JSON.stringify(userData, null, 2));
            } catch (e) {
                log('Erreur parsing user data: ' + e.message);
            }
        }
        
        // Tester l'API avec le token
        if (accessToken) {
            log('\n=== TEST API AVEC TOKEN ===');
            
            // Test GET clients
            fetch('http://localhost:3002/api/agent/clients', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + accessToken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                log('GET /api/agent/clients - Status: ' + response.status);
                return response.json();
            })
            .then(data => {
                log('GET Response: ' + JSON.stringify(data, null, 2));
                
                // Si GET fonctionne, tester DELETE
                if (data.success && data.data && data.data.length > 0) {
                    const firstClientId = data.data[0].id;
                    log('\n=== TEST DELETE CLIENT ID: ' + firstClientId + ' ===');
                    
                    return fetch('http://localhost:3002/api/agent/clients/' + firstClientId, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken,
                            'Content-Type': 'application/json'
                        }
                    });
                } else {
                    log('Aucun client trouvé pour tester la suppression');
                }
            })
            .then(response => {
                if (response) {
                    log('DELETE Status: ' + response.status);
                    return response.json();
                }
            })
            .then(data => {
                if (data) {
                    log('DELETE Response: ' + JSON.stringify(data, null, 2));
                }
            })
            .catch(error => {
                log('Erreur API: ' + error.message);
            });
        } else {
            log('Aucun token d\'accès trouvé - utilisateur non connecté');
        }
    </script>
</body>
</html>